<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="js/vue.js"></script>
    <script src="js/vuex.js"></script>
    <script src="js/vue-router.js"></script>
</head>

<body>
    <div id="app">
        <p>
            <router-link to="/home">首页</router-link>
            <router-link to="/about">关于</router-link>
            <router-link to="/product">产品</router-link>
        </p>

        <router-view></router-view>
    </div>

    <script>
        const Home = {
            template: `
            <div>
            <h2>首页{{$store.state.count}}</h2>
            <button @click="$store.commit('add')">加</button>
            <button @click="$store.dispatch('edit')">异步</button>
            </div>
            `
        }
        const About = {
            template: `
            <div>
            <h2>关于{{$store.state.count}}</h2>
            <button @click="$store.commit('add')">加</button>
            <button @click="$store.dispatch('edit')">异步</button>
            
            </div>
            `
        }
        const Product = {
            template: `
            <div>
            <h2>产品{{$store.state.count}}</h2>
            <button @click="$store.commit('add')">加</button>
            <button @click="$store.dispatch('edit')">异步</button>
            <div>{{$store.state.product}}</div>
            <div>{{$store.getters['user/info']}}</div>
            </div>
            `
        }
        const router = new VueRouter({
            routes: [
                { path: '/', redirect: '/home' },
                { path: '/home', component: Home },
                { path: '/about', component: About },
                { path: '/product', component: Product },
            ]
        })
        //user模块
        const user = {
            namespaced: true,
            state: ()=>({
                age: 24,
                name: 'tony'
            }),
            getters:{
    info(state){
      return '我叫'+state.name+'，今年'+ state.age;
    }
  },
        }
        //product模块
        const product = {
            state: ()=>({
                name: '手机'
            })
        }


        // 命名空间的作用
// 如果模块中不加命名空间，那么
// vuex会使用递归的方式从根模块开始去查找各之模块的同名函数，依次执行。
// 如果加了命名空间，那么不会采用以上方式执行而是使用命名空间的方式去触发，其他模块若有相同名称的函数，不会受影响
// commit('user/setAge');//命名空间这样调用
        const store = new Vuex.Store({
            state: {
                count: 99,
                
                },
                modules: {
                    user,
                    product
                },
                mutations: {
                    //同步操作都在这
                    add(state){
                        state.count += 1;
                    }
                    },
                actions: {
                    //异步操作在actions里
                    edit({commit}){
                        setTimeout(()=>{
                            commit('add');
                        },3000)
                    }
                }
            
        })
        const app = new Vue({
            el: '#app',
            router,
            store
        })
    </script>
</body>

</html>